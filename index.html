<!DOCTYPE html>
<html>
<head>
  <title>ROBOT00 Controller</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  <style>
    body {
      margin:0;
      padding:0;
      height:100vh;
      width:100vw;
      background:#111;
      color:white;
      font-family:Arial, sans-serif;
      overflow:hidden;
      user-select:none;
      touch-action:none;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
    }

    h2 {
      text-align:center;
      margin-bottom:20px;
      font-size:26px;
      color:white;
    }

    .control-grid {
      display:grid;
      grid-template-columns: 120px 120px 120px;
      grid-template-rows: 120px 120px 120px;
      gap:20px;
      justify-items:center;
      align-items:center;
    }

    .btn {
      width:120px;
      height:120px;
      background:rgba(255,255,255,0.15);
      border:3px solid white;
      border-radius:25px;
      font-size:40px;
      color:white;
      display:flex;
      justify-content:center;
      align-items:center;
      touch-action:none;
    }

    .ebtn {
      width:260px;
      height:120px;
      background:red;
      border:3px solid white;
      border-radius:25px;
      font-size:40px;
      color:white;
      display:flex;
      justify-content:center;
      align-items:center;
      touch-action:none;
      margin-top:30px;
    }

    .empty {
      width:120px;
      height:120px;
      background:transparent;
    }
  </style>
</head>

<body>

<h2>ROBOT00 Controls</h2>

<div class="control-grid">

  <div class="empty"></div>
  <div id="forwardBtn" class="btn">UP</div>
  <div class="empty"></div>

  <div id="leftBtn" class="btn">L</div>
  <div class="empty"></div>
  <div id="rightBtn" class="btn">R</div>

  <div class="empty"></div>
  <div id="backBtn" class="btn">DOWN</div>
  <div class="empty"></div>

</div>

<!-- ESTOP button OUTSIDE the grid -->
<div id="stopBtn" class="ebtn">ESTOP</div>

<script>
let activeCmd = null;
let intervalId = null;

function send(cmd) {
  fetch(cmd).catch(()=>{});
}

function start(cmd) {
  if (activeCmd === cmd) return;
  stop();
  activeCmd = cmd;
  send(cmd);
  intervalId = setInterval(() => send(cmd), 150);
}

function stop() {
  if (intervalId) clearInterval(intervalId);
  send('/s');
  activeCmd = null;
}

function bind(id, cmd) {
  let b = document.getElementById(id);

  b.addEventListener("touchstart", e => {
    e.preventDefault();
    start(cmd);
  });
  b.addEventListener("touchend", e => {
    e.preventDefault();
    stop();
  });

  b.addEventListener("mousedown", () => start(cmd));
  b.addEventListener("mouseup", () => stop());
  b.addEventListener("mouseleave", () => stop());
}

bind("forwardBtn", "/f");
bind("backBtn", "/b");
bind("leftBtn", "/l");
bind("rightBtn", "/r");
bind("stopBtn", "/s");

// Keyboard controls
document.addEventListener("keydown", e => {
  if (e.repeat) return;
  if (e.key === "ArrowUp" || e.key === "w") start('/f');
  if (e.key === "ArrowDown" || e.key === "s") start('/b');
  if (e.key === "ArrowLeft" || e.key === "a") start('/l');
  if (e.key === "ArrowRight"|| e.key === "d") start('/r');
});

document.addEventListener("keyup", stop);
</script>

</body>
</html>
